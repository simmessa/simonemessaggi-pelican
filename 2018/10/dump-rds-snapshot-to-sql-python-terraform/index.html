<!doctype html><html lang=it><meta charset=utf-8><meta charset=utf-8 content=text/html http-equiv=Content-Type><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><title>Fare un dump da uno snapshot RDS con Python e Terraform</title><meta content="Il sito personale di Simone Messaggi, blog tecnico opinionistico musicale di uno che di errori ne ha commessi, e tanti." name=description><meta content=True name=HandheldFriendly><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=origin name=referrer><meta content=Pelican name=generator><link href=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/ rel=canonical><link title="SimoneMessaggi.it Full Atom Feed" href=https://www.simonemessaggi.it/feeds/all.atom.xml rel=alternate type=application/atom+xml><link title="SimoneMessaggi.it Categories Atom Feed" href=https://www.simonemessaggi.it/feeds/tech.atom.xml rel=alternate type=application/atom+xml><link href="https://www.simonemessaggi.it/theme/css/style.css?cb=122445" rel=stylesheet><link href=https://www.simonemessaggi.it/extra/ico/favicon.ico rel=icon><link href=https://www.simonemessaggi.it/extra/ico/favicon.svg rel=icon type=image/svg+xml><link href=https://www.simonemessaggi.it/extra/ico/apple-touch-icon.png rel=apple-touch-icon><link href=https://www.simonemessaggi.it/extra/ico/site.webmanifest rel=manifest><link href="https://www.simonemessaggi.it/theme/css/simonemessaggi.css?cb=122445" media=screen rel=stylesheet><script>var siteUrl = 'https://www.simonemessaggi.it';</script><script>var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }</script><meta content="Ok, già tutti voi conoscete le prodezze del cloud di Amazon, per cui non vi annoio con i dettagli, e se i vostri server si trovano su..." name=description><meta content=simmessa name=author><meta content="AWS Cloud" name=tags><meta content=RDS name=tags><meta content=MySQL name=tags><meta content=Terraform name=tags><meta content=Python name=tags><meta content=Howto name=tags><meta prefix="og: http://ogp.me/ns#" content=SimoneMessaggi.it property=og:site_name><meta content="Fare un dump da uno snapshot RDS con Python e Terraform" prefix="og: http://ogp.me/ns#" property=og:title><meta content="Ok, già tutti voi conoscete le prodezze del cloud di Amazon, per cui non vi annoio con i dettagli, e se i vostri server si trovano su..." prefix="og: http://ogp.me/ns#" property=og:description><meta prefix="og: http://ogp.me/ns#" content=en_US property=og:locale><meta prefix="og: http://ogp.me/ns#" content=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/ property=og:url><meta prefix="og: http://ogp.me/ns#" content=article property=og:type><meta content="2018-10-31 00:00:00+01:00" prefix="og: http://ogp.me/ns#" property=article:published_time><meta prefix="og: http://ogp.me/ns#" property=article:modified_time><meta prefix="og: http://ogp.me/ns#" content=https://www.simonemessaggi.it/author/simmessa/ property=article:author><meta prefix="og: http://ogp.me/ns#" content=Tech property=article:section><meta content="AWS Cloud" prefix="og: http://ogp.me/ns#" property=article:tag><meta prefix="og: http://ogp.me/ns#" content=RDS property=article:tag><meta prefix="og: http://ogp.me/ns#" content=MySQL property=article:tag><meta prefix="og: http://ogp.me/ns#" content=Terraform property=article:tag><meta prefix="og: http://ogp.me/ns#" content=Python property=article:tag><meta prefix="og: http://ogp.me/ns#" content=Howto property=article:tag><meta prefix="og: http://ogp.me/ns#" content=https://www.simonemessaggi.it/images/webp/AWS-Feature.webp property=og:image><meta content=summary_large_image name=twitter:card><meta content=@simmessa name=twitter:site><meta content="Fare un dump da uno snapshot RDS con Python e Terraform" name=twitter:title><meta content=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/ name=twitter:url><meta content=https://www.simonemessaggi.it/images/webp/AWS-Feature.webp name=twitter:image:src><meta content="Ok, già tutti voi conoscete le prodezze del cloud di Amazon, per cui non vi annoio con i dettagli, e se i vostri server si trovano su..." name=twitter:description><script type=application/ld+json>
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Fare un dump da uno snapshot RDS con Python e Terraform",
  "headline": "Fare un dump da uno snapshot RDS con Python e Terraform",
  "datePublished": "2018-10-31 00:00:00+01:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Simmessa",
    "url": "https://www.simonemessaggi.it/author/simmessa/"
  },
  "image": "https://www.simonemessaggi.it/images/webp/AWS-Feature.webp",
  "url": "https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/",
  "description": "Ok, già tutti voi conoscete le prodezze del cloud di Amazon, per cui non vi annoio con i dettagli, e se i vostri server si trovano su..."
}
</script><link href=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/ rel=canonical><script type=application/ld+json>{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "SimoneMessaggi.it", "item": "https://www.simonemessaggi.it"}, {"@type": "ListItem", "position": 2, "name": "2018", "item": "https://www.simonemessaggi.it/2018"}, {"@type": "ListItem", "position": 3, "name": "10", "item": "https://www.simonemessaggi.it/2018/10"}, {"@type": "ListItem", "position": 4, "name": "Dump rds snapshot to sql python terraform", "item": "https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform"}, {"@type": "ListItem", "position": 5, "name": "Index", "item": "https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/index.html"}]}</script><script type=application/ld+json>{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "simmessa"}, "publisher": {"@type": "Organization", "name": "SimoneMessaggi.it"}, "headline": "Fare un dump da uno snapshot RDS con Python e Terraform", "about": "Tech", "datePublished": "2018-10-31 00:00"}</script><meta content=summary name=twitter:card><meta content=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/ property=og:url><meta content=article property=og:type><meta content="Fare un dump da uno snapshot RDS con Python e Terraform" property=og:title><meta content=en_US property=og:locale><body class=category-template><div class=nav-header><nav aria-label=Main class=nav-wrapper><ul><li class=nav-Home role=presentation><a href=/><span>Home</span></a><li class=nav-Rants role=presentation><a href=/category/rants/><span>Rants</span></a><li class="nav-Tech active" role=presentation><a href=/category/tech/><span>Tech</span></a><li class=nav-Humans role=presentation><a href=/category/humans/><span>Humans</span></a><li class=nav-Music role=presentation><a href=/category/music/><span>Music</span></a><li role=presentation><a href=https://www.simonemessaggi.it/pages/contact/><span>Contact</span></a></ul><ul class=nav-meta><li class=nav-twitter><a aria-label=Twitter href=http://twitter.com/simmessa target=_blank><i class="icon icon-twitter" aria-hidden=true></i> <span>Twitter</span> </a><li class=nav-github><a aria-label=Github href=https://github.com/simmessa target=_blank><i class="icon icon-github" aria-hidden=true></i> <span>Github</span> </a></ul></nav><div class=nav-wrapper-control><div class=inner><a class=nav-menu role=button><i class="icon icon-menu" aria-hidden=true></i>Menu</a><a class=nav-search role=button style=display:none title=Search><i class="icon icon-search" aria-hidden=true></i></a></div></div></div><div aria-label=Close class=nav-close role=button></div><section class=page-wrapper id=wrapper><div class=progress-container><span class=progress-bar></span></div><header class="post-header has-cover"><div class=inner><span class=post-info> <a href=https://www.simonemessaggi.it><span class=post-type>Home</span></a> >  <span class=post-type>Article</span> <a href=https://www.simonemessaggi.it/category/tech/><span class=post-count>Tech</span></a> </span><h1 class=post-title>Fare un dump da uno snapshot RDS con Python e Terraform</h1><div class=post-meta><div class=post-meta-avatars><figure class="post-meta-avatar avatar"><a class=author-avatar href=https://www.simonemessaggi.it/author/simmessa/> <img alt="Simone Messaggi" class=author-profile-image fetchpriority=high rel=preload src=https://www.simonemessaggi.it/images/simmessa.png> </a></figure></div><h4 class=post-meta-author>Simone Messaggi</h4><time datetime="Wed 31 October 2018">Wed 31 October 2018</time> • 9 min read <div><hr><p>Read <strong><a href=https://www.simonemessaggi.it/2018/10/en/dump-rds-snapshot-to-sql-python-terraform/>this article</a></strong> in English language <strong><a href=https://www.simonemessaggi.it/2018/10/en/dump-rds-snapshot-to-sql-python-terraform/> here >></a></strong></div></div><div class="post-cover cover"><img alt="Category Tech" fetchpriority=high rel=preload src=https://www.simonemessaggi.it/images/webp/AWS-Feature.webp></div></div></header><main class=content role=main><article class=post><div class=inner><section class=post-content><p>Ok, già tutti voi conoscete le prodezze del cloud di Amazon, per cui non vi annoio con i dettagli, e se i vostri server si trovano su AWS è molto facile che già utilizziate il loro <em>db engine as a service</em>, ovvero <strong>RDS</strong> (che sta per Relational Database Service).<p><em>Repost di articolo apparso per la prima volta su <a href=https://medium.com/@simmessa/fare-un-dump-da-uno-snapshot-rds-con-python-e-terraform-7cbd0fa026fc>Medium</a></em><p>Oggi parliamo proprio di un hack utile per chi usa questo servizio, e nello specifico, andremo a vedere come creare un classico dump del db (formato .sql) da un'istanza di database.<h2>Ma non esistono già i backup?</h2><p>RDS, tra le tante cose interessanti, offre la funzionalità di avere dei backup automatici, ed se lo avete provato sapete già che è davvero comodo. In ogni momento potete ripristinare uno snapshot esistente o anche creare una nuova istanza del database, di cui scegliere la dimensione (intesa come "potenza" del server), andando a pescare dai dati dello snapshot.<p><img alt="RDS ha degli ottimi backup, ma non sono i dump sql che servono a noi…" src=/images/RDS_snapshot.png> <em>RDS ha degli ottimi backup, ma non sono i dump sql che servono a noi…</em><p>Spesso mi è capitato di pensare che questi backup fossero già quello che mi serviva, ovvero un modo come un altro di dumpare il db in file sql compresso per duplicare un servizio, purtroppo mi sono accorto a mie spese che non è così semplice, soprattutto se vi va di automatizzare il processo e volete trovare il modo di rischiare il meno possibile con un db live in produzione.<p>Il succo del discorso è che, su RDS, è estremamente facile duplicare un database tramite snapshot e creando una nuova istanza, ma il livello di portabilità di questo genere di "dump" è praticamente nullo, vale solo su RDS.<p>Al contrario, se volete ottenere un dump non è così banale.<h2>Il metodo basic</h2><p>Il processo è abbastanza semplice:<ul><li>Creiamo uno snapshot<li>Lanciamo una nuova istanza di db "piccola" a piacere (ad esempio una db.t2.micro, con 1 vCPU e 1 Gb di RAM) selezionando come source lo snapshot che ci interessa<li>Ci colleghiamo via <strong>mysqldump</strong> alla nuova istanza e produciamo il dump del database che ci serve</ul><p>Farlo manualmente ogni volta, però, lo trovo pallosetto, per cui ho cercato (grazie Google!) ed elaborato un metodo più furbo ed automatico di farlo<h2>Alcune accortezze LIVE</h2><p>Se per caso volete avere il dump di un database di produzione e volete evitare problemi, accontentandovi anche di dati non freschissimi, vi consiglio per cominciare di impostare i job di backup / creazione degli snapshot nella fascia dove avete meno accessi al vostro servzio, potrebbe essere in fascia notturna, ma sta a voi scoprirlo e, in ogni caso, se è un servizio pubblico Google Analytics è vostro amico, altrimenti buona ricerca nei log.<h2>Il metodo Terraform + Python script</h2><p>Premetto che trovate il codice di esempio di questo articolo sul mio profilo <a href=https://github.com/simmessa/rds_snaptodump>github</a>, e ora andiamo a vedere con ordine cosa dobbiamo fare per andare a creare il dump in questo modo.<p>Prima di proseguire clonate il repo ed entrateci con:<div class=highlight><pre><span></span><code>$<span class=w> </span>git<span class=w> </span>clone<span class=w> </span>https://github.com/simmessa/rds_snaptodump
<span class=nb>cd</span><span class=w> </span>rds_snaptodump
</code></pre></div><h3>Prerequisiti vari</h3><p>Per eseguire i file del repository vi serve:<ul><li>terraform (per l'installazione vedete qui sotto)<li>mysqldump<li>un account AWS con i privilegi necessari per interagire con RDS (lettura, list dei database, ecc) (altre informazioni qui sotto)<li>python 2 (ho testato con la versione 2.7.12)</ul><h3>Installare Terraform</h3><p>Per prima cosa vi consiglio di installare <a href=https://www.terraform.io>Terraform</a>, è un tool fatto dai simpatici signori di <a href=https://www.hashicorp.com/>Hashicorp</a> che è molto utile e vi aprirà un mondo sul modo di creare infrastrutture in cloud da riga di comando, ma, ovviamente, lo scope di questo articolo non ci consente di approfondire l'argomento.<p>Sappiate almeno che, con terraform, potrete lanciare comandi che andranno a definire, in base a degli script, ambienti in cloud su AWS, GKE o altro.<p>Non ho idea se Terraform sia in bundle grazie al pkg manager della vostra distro Linux preferita (o magari su <a href=https://medium.com/@simmessa/installare-un-ambiente-di-sviluppo-linux-su-windows-10-wsl-fc638bb4ff8e>WSL</a> sotto windows 10), ma per installarlo da riga di comando la procedura è molto semplice, andate <a href=https://www.terraform.io/downloads.html>qui</a>, scaricatevi il binario adeguato e poi unzippatelo:<div class=highlight><pre><span></span><code>$<span class=w> </span>wget<span class=w> </span>https://releases.hashicorp.com/terraform/0.11.10/terraform_0.11.10_linux_amd64.zip<span class=p>;</span><span class=w> </span>unzip<span class=w> </span>terraform_0.11.10_linux_amd64.zip
</code></pre></div><p>Ottimo a questo punto vi dovreste trovare con il binario di terraform dentro il repository github precedentemente clonato.<p>Per verificare l'install di terraform non vi resta che provare ad eseguire terraform:<div class=highlight><pre><span></span><code><span class=o>./</span><span class=n>terraform</span>
<span class=n>Usage</span><span class=p>:</span><span class=w> </span><span class=n>terraform</span><span class=w> </span><span class=p>[</span><span class=o>-</span><span class=n>version</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=o>-</span><span class=n>help</span><span class=p>]</span><span class=w> </span><span class=o>&lt;</span><span class=n>command</span><span class=o>></span><span class=w> </span><span class=p>[</span><span class=n>args</span><span class=p>]</span>

<span class=n>The</span><span class=w> </span><span class=n>available</span><span class=w> </span><span class=n>commands</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>execution</span><span class=w> </span><span class=n>are</span><span class=w> </span><span class=n>listed</span><span class=w> </span><span class=n>below</span><span class=o>.</span>
<span class=n>The</span><span class=w> </span><span class=n>most</span><span class=w> </span><span class=n>common</span><span class=p>,</span><span class=w> </span><span class=n>useful</span><span class=w> </span><span class=n>commands</span><span class=w> </span><span class=n>are</span><span class=w> </span><span class=n>shown</span><span class=w> </span><span class=n>first</span><span class=p>,</span><span class=w> </span><span class=n>followed</span><span class=w> </span><span class=n>by</span>
<span class=n>less</span><span class=w> </span><span class=n>common</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=n>more</span><span class=w> </span><span class=n>advanced</span><span class=w> </span><span class=n>commands</span><span class=o>.</span><span class=w> </span><span class=n>If</span><span class=w> </span><span class=n>you</span><span class=s1>'re just getting</span>
<span class=n>started</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>Terraform</span><span class=p>,</span><span class=w> </span><span class=n>stick</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>common</span><span class=w> </span><span class=n>commands</span><span class=o>.</span><span class=w> </span><span class=n>For</span><span class=w> </span><span class=n>the</span>
<span class=n>other</span><span class=w> </span><span class=n>commands</span><span class=p>,</span><span class=w> </span><span class=n>please</span><span class=w> </span><span class=n>read</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>help</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=n>before</span><span class=w> </span><span class=n>usage</span><span class=o>.</span>

<span class=n>Common</span><span class=w> </span><span class=n>commands</span><span class=p>:</span>
<span class=w>    </span><span class=n>apply</span><span class=w>              </span><span class=n>Builds</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=n>changes</span><span class=w> </span><span class=n>infrastructure</span>
<span class=w>    </span><span class=n>console</span><span class=w>            </span><span class=n>Interactive</span><span class=w> </span><span class=n>console</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>interpolations</span>
<span class=w>    </span><span class=n>destroy</span><span class=w>            </span><span class=n>Destroy</span><span class=w> </span><span class=n>Terraform</span><span class=o>-</span><span class=n>managed</span><span class=w> </span><span class=n>infrastructure</span>
<span class=w>    </span><span class=n>env</span><span class=w>                </span><span class=n>Workspace</span><span class=w> </span><span class=n>management</span>
<span class=w>    </span><span class=n>fmt</span><span class=w>                </span><span class=n>Rewrites</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=n>files</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>canonical</span><span class=w> </span><span class=nb>format</span>
<span class=w>    </span><span class=n>get</span><span class=w>                </span><span class=n>Download</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=n>install</span><span class=w> </span><span class=n>modules</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>configuration</span>
<span class=w>    </span><span class=n>graph</span><span class=w>              </span><span class=n>Create</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>visual</span><span class=w> </span><span class=n>graph</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>resources</span>
<span class=w>    </span><span class=kn>import</span><span class=w>             </span><span class=nn>Import</span><span class=w> </span><span class=n>existing</span><span class=w> </span><span class=n>infrastructure</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=n>Terraform</span>
<span class=w>    </span><span class=n>init</span><span class=w>               </span><span class=n>Initialize</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>working</span><span class=w> </span><span class=n>directory</span>
<span class=w>    </span><span class=n>output</span><span class=w>             </span><span class=n>Read</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=kn>from</span><span class=w> </span><span class=nn>a</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=n>file</span>
<span class=w>    </span><span class=n>plan</span><span class=w>               </span><span class=n>Generate</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=n>show</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>execution</span><span class=w> </span><span class=n>plan</span>
<span class=w>    </span><span class=n>providers</span><span class=w>          </span><span class=n>Prints</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>tree</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>providers</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>configuration</span>
<span class=w>    </span><span class=n>push</span><span class=w>               </span><span class=n>Upload</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>module</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>Atlas</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>run</span>
<span class=w>    </span><span class=n>refresh</span><span class=w>            </span><span class=n>Update</span><span class=w> </span><span class=n>local</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=n>against</span><span class=w> </span><span class=n>real</span><span class=w> </span><span class=n>resources</span>
<span class=w>    </span><span class=n>show</span><span class=w>               </span><span class=n>Inspect</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=n>plan</span>
<span class=w>    </span><span class=n>taint</span><span class=w>              </span><span class=n>Manually</span><span class=w> </span><span class=n>mark</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>resource</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>recreation</span>
<span class=w>    </span><span class=n>untaint</span><span class=w>            </span><span class=n>Manually</span><span class=w> </span><span class=n>unmark</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>resource</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>tainted</span>
<span class=w>    </span><span class=n>validate</span><span class=w>           </span><span class=n>Validates</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>files</span>
<span class=w>    </span><span class=n>version</span><span class=w>            </span><span class=n>Prints</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>Terraform</span><span class=w> </span><span class=n>version</span>
<span class=w>    </span><span class=n>workspace</span><span class=w>          </span><span class=n>Workspace</span><span class=w> </span><span class=n>management</span>

<span class=n>All</span><span class=w> </span><span class=n>other</span><span class=w> </span><span class=n>commands</span><span class=p>:</span>
<span class=w>    </span><span class=n>debug</span><span class=w>              </span><span class=n>Debug</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=n>management</span><span class=w> </span><span class=p>(</span><span class=n>experimental</span><span class=p>)</span>
<span class=w>    </span><span class=n>force</span><span class=o>-</span><span class=n>unlock</span><span class=w>       </span><span class=n>Manually</span><span class=w> </span><span class=n>unlock</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>terraform</span><span class=w> </span><span class=n>state</span>
<span class=w>    </span><span class=n>state</span><span class=w>              </span><span class=n>Advanced</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=n>management</span>
</code></pre></div><p>Se l'output è come quello che vedete qui sopra siete a posto, terraform è pronto per essere usato.<h3>Editare lo script main.tf</h3><p>Ora che avete Terraform a disposizione dovrete editare lo script che useremo per creare l'istanza del nostro database di cui ottenere il dump.<p>Si chiama main.tf e lo trovate qui sotto:<div class=highlight><pre><span></span><code>provider<span class=w> </span>"aws"<span class=w> </span>{
<span class=w>  </span>region<span class=w> </span>=<span class=w> </span>"eu-west-1"<span class=w> </span>#<span class=w> </span>put<span class=w> </span>your<span class=w> </span>AWS<span class=w> </span>region<span class=w> </span>here!
}

#<span class=w> </span>Get<span class=w> </span>latest<span class=w> </span>snapshot<span class=w> </span>from<span class=w> </span>production<span class=w> </span>DB
data<span class=w> </span>"aws_db_snapshot"<span class=w> </span>"latest_prod_snapshot"<span class=w> </span>{
<span class=w>    </span>most_recent<span class=w> </span>=<span class=w> </span>true
<span class=w>    </span>db_instance_identifier<span class=w> </span>=<span class=w> </span>"mydbname"<span class=w> </span>#<span class=w> </span>put<span class=w> </span>the<span class=w> </span>name<span class=w> </span>of<span class=w> </span>your<span class=w> </span>db<span class=w> </span>here!
}
#<span class=w> </span>Create<span class=w> </span>new<span class=w> </span>staging<span class=w> </span>DB
resource<span class=w> </span>"aws_db_instance"<span class=w> </span>"db_snapshot_dumper"<span class=w> </span>{
<span class=w>  </span>instance_class<span class=w>       </span>=<span class=w> </span>"db.t2.micro"
<span class=w>  </span>identifier<span class=w>           </span>=<span class=w> </span>"db-snapshot-dumper"
<span class=w>  </span>username<span class=w>             </span>=<span class=w> </span>"user"<span class=w> </span>#<span class=w> </span>necessary,<span class=w> </span>but<span class=w> </span>won't<span class=w> </span>be<span class=w> </span>used<span class=w> </span>since<span class=w> </span>a<span class=w> </span>snapshot<span class=w> </span>identifier<span class=w> </span>is<span class=w> </span>provided...
<span class=w>  </span>password<span class=w>             </span>=<span class=w> </span>"password"<span class=w> </span>#<span class=w> </span>necessary,<span class=w> </span>but<span class=w> </span>won't<span class=w> </span>be<span class=w> </span>used<span class=w> </span>since<span class=w> </span>a<span class=w> </span>snapshot<span class=w> </span>identifier<span class=w> </span>is<span class=w> </span>provided...
<span class=w>  </span>snapshot_identifier<span class=w>  </span>=<span class=w> </span>"<span class=cp>${</span><span class=n>data</span><span class=o>.</span><span class=n>aws_db_snapshot</span><span class=o>.</span><span class=n>latest_prod_snapshot</span><span class=o>.</span><span class=n>id</span><span class=cp>}</span>"
<span class=w>  </span>#vpc_security_group_ids<span class=w> </span>=<span class=w> </span>["sg-12345678"]<span class=w> </span>#<span class=w> </span>if<span class=w> </span>you<span class=w> </span>are<span class=w> </span>running<span class=w> </span>inside<span class=w> </span>a<span class=w> </span>VPC<span class=w> </span>uncomment<span class=w> </span>and<span class=w> </span>put<span class=w> </span>yours<span class=w> </span>here
<span class=w>  </span>skip_final_snapshot<span class=w> </span>=<span class=w> </span>true<span class=w> </span>#<span class=w> </span>Won't<span class=w> </span>produce<span class=w> </span>a<span class=w> </span>final<span class=w> </span>snapshot<span class=w> </span>when<span class=w> </span>disposing<span class=w> </span>of<span class=w> </span>db
}

output<span class=w> </span>"address"<span class=w> </span>{
<span class=w>  </span>value<span class=w> </span>=<span class=w> </span>"<span class=cp>${</span><span class=n>aws_db_instance</span><span class=o>.</span><span class=n>db_snapshot_dumper</span><span class=o>.</span><span class=n>address</span><span class=cp>}</span>"
}

output<span class=w> </span>"snapshot"<span class=w> </span>{
<span class=w>  </span>value<span class=w> </span>=<span class=w> </span>"<span class=cp>${</span><span class=n>aws_db_instance</span><span class=o>.</span><span class=n>db_snapshot_dumper</span><span class=o>.</span><span class=n>snapshot_identifier</span><span class=cp>}</span>"
}
</code></pre></div><p>Ci sono varie cose che dovrete cambiare per adattarle al vostro caso specifico, come la regione AWS in cui usate il servizio RDS:<div class=highlight><pre><span></span><code><span class=n>provider</span><span class=w> </span><span class=s>"aws"</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"eu-west-1"</span><span class=w> </span><span class=p>#</span><span class=w> </span><span class=n>put</span><span class=w> </span><span class=n>your</span><span class=w> </span><span class=n>AWS</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=n>here</span><span class=o>!</span>
<span class=p>}</span>
<span class=p>[...]</span>
</code></pre></div><p>e l'identificativo del vostro database, come risulta dal pannello di RDS:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=c1># Get latest snapshot from production DB</span>
<span class=na>data "aws_db_snapshot" "latest_prod_snapshot" {</span>
<span class=w>    </span><span class=na>most_recent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>true</span>
<span class=w>    </span><span class=na>db_instance_identifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"mydbname"</span><span class=w> </span><span class=c1># put the name of your db here!</span>
<span class=na>}</span>
<span class=k>[...]</span>
</code></pre></div><p>Infine, se la vostra infrastruttura sul cloud prevede una vpc, vi consiglio di decommentare l'apposita riga e di inserire l'id della vostra vpc:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=w>  </span><span class=c1>#vpc_security_group_ids = ["sg-12345678"] # if you are running inside a VPC uncomment and put yours here</span>
<span class=k>[...]</span>
</code></pre></div><p>Vorrei cogliere l'occasione per farvi notare che non abbiamo dovuto dare a Terraform l'id di uno snapshot specifico, al contrario, gli abbiamo chiesto di usare l'ultimo a disposizione (most_recent = true):<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=c1># Get latest snapshot from production DB</span>
<span class=na>data "aws_db_snapshot" "latest_prod_snapshot" {</span>
<span class=w>    </span><span class=na>most_recent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>true</span>
<span class=w>    </span><span class=na>db_instance_identifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"mydbname"</span><span class=w> </span><span class=c1># put the name of your db here!</span>
<span class=na>}</span>
<span class=k>[...]</span>
</code></pre></div><p>Lo trovo fantastico, per i miei scopi, ma se per caso avete bisogno di uno snapshot specifico, vi rimando all'ottima <a href=https://www.terraform.io/docs/providers/aws/d/db_snapshot.html>documentazione di Terraform</a> per i dettagli.<p>Una volta fatte queste operazioni possiamo passare a modificare la parte Python del nostro dumper.<h3>Editare lo script Python snaptodump.py</h3><p>Lo script "snaptodump.py" nella sua forma "originale" lo trovate qui sotto:<div class=highlight><pre><span></span><code><span class=c1>#Python</span>

<span class=kn>from</span><span class=w> </span><span class=nn>sys</span><span class=w> </span><span class=kn>import</span><span class=w> </span><span class=n>argv</span>
<span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span><span class=w> </span><span class=n>datetime</span>

<span class=kn>import</span><span class=w> </span><span class=nn>sys</span><span class=o>,</span><span class=w> </span><span class=nn>os</span><span class=o>,</span><span class=w> </span><span class=nn>os.path</span>

<span class=n>start_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>

<span class=c1># MySQL setup: put the MySQL user with dump permission and database name here</span>
<span class=c1># password will be asked interactively later: </span>

<span class=n>dbusr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"your_mysql_username"</span><span class=w> </span>
<span class=n>dbname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"your_mysql_database_name"</span>

<span class=nb>print</span><span class=w> </span><span class=s2>"""</span>

<span class=s2>This script will launch Terraform to dump the latest snapshot of prod db</span>

<span class=s2>PREREQUISITES:</span>

<span class=s2>You need AWS tokens setup as ENV vars or Terraform won't work:</span>
<span class=s2>export AWS_ACCESS_KEY_ID="xxx"</span>
<span class=s2>export AWS_SECRET_ACCESS_KEY="yyy"</span>

<span class=s2>USAGE:</span>

<span class=s2>python snaptodump.py</span>

<span class=s2>*** WARNING ***</span>
<span class=s2>This tool requires the mysqldump binary installed on your system and the necessary free space on your local disk for dumping!</span>

<span class=s2>"""</span>

<span class=n>terraform_init_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"./.terraform"</span>

<span class=k>if</span><span class=w> </span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>terraform_init_dir</span><span class=p>):</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"terraform init already ran!</span><span class=se>\n</span><span class=s2>"</span>
<span class=k>else</span><span class=p>:</span>
<span class=w>    </span><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=w> </span><span class=s2>"./terraform init"</span><span class=p>)</span>

<span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=w> </span><span class=s2>"./terraform apply"</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>):</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"*** ERROR while applying terraform config, dumping stopped! ***"</span>
<span class=w>    </span><span class=n>exit</span><span class=p>()</span>

<span class=n>host</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>'./terraform output address'</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
<span class=n>filename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>'./terraform output snapshot'</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>".sql.gz"</span>

<span class=n>dumpcmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"mysqldump -h </span><span class=si>%s</span><span class=s2> -u </span><span class=si>%s</span><span class=s2> --compress -p </span><span class=si>%s</span><span class=s2> |gzip > </span><span class=si>%s</span><span class=s2>"</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=p>(</span><span class=n>host</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>'</span><span class=se>\n</span><span class=s1>'</span><span class=p>,</span><span class=s1>''</span><span class=p>),</span><span class=w> </span><span class=n>dbusr</span><span class=p>,</span><span class=w> </span><span class=n>dbname</span><span class=p>,</span><span class=w> </span><span class=n>filename</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>'</span><span class=se>\n</span><span class=s1>'</span><span class=p>,</span><span class=s1>''</span><span class=p>))</span>

<span class=nb>print</span><span class=w> </span><span class=s2>"Next step is mysqldump, you will be asked for a MySQL password</span><span class=se>\n</span><span class=s2>"</span>

<span class=n>dbdump_start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>

<span class=k>if</span><span class=w> </span><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=w> </span><span class=n>dumpcmd</span><span class=w> </span><span class=p>):</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"An error occurred!"</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"command was: </span><span class=si>%s</span><span class=s2>"</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>dumpcmd</span>
<span class=k>else</span><span class=p>:</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"All done!"</span>
<span class=w>    </span><span class=nb>print</span><span class=w> </span><span class=s2>"Db dumped in </span><span class=si>%s</span><span class=s2>"</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>dbdump_start</span><span class=w> </span><span class=p>)</span>

<span class=c1>#Now let's destroy our temp RDS instance</span>
<span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=w> </span><span class=s2>"./terraform destroy "</span><span class=p>)</span>

<span class=c1>#Feeling bold? comment previous command and enable this!</span>
<span class=c1>#os.system( "./terraform destroy -auto-approve"</span>

<span class=nb>print</span><span class=w> </span><span class=s2>"Total procedure completed in </span><span class=si>%s</span><span class=se>\n</span><span class=s2>"</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start_time</span><span class=w> </span><span class=p>)</span>

<span class=c1>#print dumpcmd</span>
</code></pre></div><p>Dovrete modificare alcune variabili per farlo girare sulle vostre istanze di db, prima di tutto, è necessario inserire user e nome del database mysql che volete dumpare:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=na>dbusr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"your_mysql_username"</span><span class=w> </span>
<span class=na>dbname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"your_mysql_database_name"</span>
<span class=k>[...]</span>
</code></pre></div><p>diventerà, ad esempio:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=na>dbusr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"pippo"</span><span class=w> </span>
<span class=na>dbname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>"dbproduzione"</span>
<span class=k>[...]</span>
</code></pre></div><p>A questo punto, se provate a lanciare lo script:<div class=highlight><pre><span></span><code>$<span class=w> </span>python<span class=w> </span>snaptodump.py
</code></pre></div><p>Vi accorgerete che, per funzionare, necessita della parte di autenticazione AWS, senza di cui Terraform non può dialogare con AWS.<h3>Autenticazione e chiavi di accesso AWS</h3><p>Per poter interagire con il cloud AWS vi serve definire due variabili di sistema, contenenti le vostre credenziali con cui configurare RDS:<div class=highlight><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=n>AWS_ACCESS_KEY_ID</span><span class=o>=</span><span class=s2>"xxx"</span>
<span class=k>export</span><span class=w> </span><span class=n>AWS_SECRET_ACCESS_KEY</span><span class=o>=</span><span class=s2>"yyy"</span>
</code></pre></div><p><strong>ATTENZIONE: Non fate girare lo script utilizzando credenziali con tutti i permessi (come il root account) o comunque con credenziali superiori a quelle strettamente necessarie per fare il dump di database RDS</strong><p>Facendo girare Terraform con tutti i privilegi AWS potreste letteramente cancellarvi il vostro ambiente in cloud, per cui ho pensato di mettere l'avviso qui sopra.<p>A questo titolo, visto che ci ho perso un po' di tempo, mi sembra opportuno definire quali siano questi permessi di AWS IAM necessari all'esecuzione del dump, vediamoli assieme.<p>Prima di tutto ho creato un utente e un gruppo appositi, i permessi necessari sono ovviamente definiti all'interno del gruppo, per poterli applicare più velocemente ad un eventuale nuovo utente futuro.<p>Definito il gruppo "db_dumpers", ho poi creato le policy necessarie ad interagire con RDS, e sono due.<p>La prima, fa parte delle policy pre-configurate di AmazonRDS, e si chiama:<p>"AmazonRDSReadOnlyAccess"<p>in json, il contenuto è questo:<div class=highlight><pre><span></span><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Action": [
        "rds:Describe*",
        "rds:ListTagsForResource",
        "ec2:DescribeAccountAttributes",
        "ec2:DescribeAvailabilityZones",
        "ec2:DescribeInternetGateways",
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeSubnets",
        "ec2:DescribeVpcAttribute",
        "ec2:DescribeVpcs"
      ],
      "Effect": "Allow",
      "Resource": "*"
    },
    {
      "Action": [
        "cloudwatch:GetMetricStatistics",
        "logs:DescribeLogStreams",
        "logs:GetLogEvents"
      ],
      "Effect": "Allow",
      "Resource": "*"
    }
  ]
}
</code></pre></div><p>Come potete vedere, oltre a RDS contiene alcuni privilegi utili per ec2, tra cui sottoreti, security group e VPC, a cui si aggiungono permessi per il logging cloudwatch. Il tutto, ovviamente, in sola lettura.<p>Oltre a questa policy, ne ho dovuta creare una seconda, customizzata, per permettere di agire sul servizio RDS:<div class=highlight><pre><span></span><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "VisualEditor0",
      "Effect": "Allow",
      "Action": [
        "rds:RestoreDBInstanceFromDBSnapshot",
        "rds:CreateDBInstance",
        "rds:ModifyDBInstance",
        "rds:DeleteDBInstance"
      ],
      "Resource": [
        "arn:aws:rds:*:*:snapshot:*",
        "arn:aws:rds:*:*:secgrp:*",
        "arn:aws:rds:*:*:subgrp:*",
        "arn:aws:rds:*:*:og:*",
        "arn:aws:rds:eu-west-1:123456789012:db:db-snapshot-dumper",
        "arn:aws:rds:*:*:pg:*"
      ]
    }
  ]
}
</code></pre></div><p>Come vedete, qui dentro si ha la possibilità di andare a creare nuove istanze di RDS, modificarle, cancellarle e su cui poi ripristinare i dati degli snapshot.<p>Per un'ulteriore sicurezza, ho limitato i permessi di RDS solo ad alcuni ARN (che sono identificatori di risorse Amazon) specifici dell'ambiente su cui sto operando, questo perché voglio far si che questa utenza non possa fare danni sul mio db principale.<p>Se ci fate caso, c'è una corrispondenza uno ad uno tra l'istanza che terraform crea per assegnargli lo snapshot e l'ARN che ho definito nella policy.<p>Dallo script main.tf:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=na>identifier</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=s>"db-snapshot-dumper"</span>
<span class=k>[...]</span>
</code></pre></div><p>Mentre dalla policy AWS sopra definita:<div class=highlight><pre><span></span><code><span class=k>[...]</span>
<span class=w>      </span><span class=na>"Resource"</span><span class=o>:</span><span class=w> </span><span class=s>[</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:*:*:snapshot:*",</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:*:*:secgrp:*",</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:*:*:subgrp:*",</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:*:*:og:*",</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:eu-west-1:123456789012:db:db-snapshot-dumper",</span>
<span class=w>        </span><span class=na>"arn</span><span class=o>:</span><span class=s>aws:rds:*:*:pg:*"</span>
<span class=w>      </span><span class=na>]</span>
<span class=k>[...]</span>
</code></pre></div><p>Una volta create le due policy vi basterà assegnarle al gruppo "db_dumpers" per poi farci rientrare il vostro utente, di cui avrete conservato le credenziali.<h3>Lanciare lo script</h3><p>A questo punto abbiamo preparato tutto e non ci resta che lanciare lo script:<div class=highlight><pre><span></span><code>$<span class=w> </span>python<span class=w> </span>snaptodump.py
</code></pre></div><p>Dovreste trovarvi, nel giro di qualche oretta, ad avere, nella cartella in cui avete lanciato lo script, un file con il vostro dump del db, con il formato .sql.gz<p>Se invece qualcosa dovesse essere andato storto, riceverete un messaggio d'errore dallo script o da terraform.<p>Vi ringrazio dell'attenzione, ovviamente in caso di problemi o di possibili migliorie, non esitate a commentare qui sotto.<p>p.s.: commenti disabilitati (n.d.a)<div id=back_home><p><a href=https://www.simonemessaggi.it>done reading? go back to the homepage ></a></div></section><section class=post-footer><div class=post-share><span class=post-info-label>Share</span><a href="https://twitter.com/share?text=Fare un dump da uno snapshot RDS con Python e Terraform&url=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label=Twitter class=twitter title=Twitter> <i class="icon icon-twitter" aria-hidden=true></i><span class=hidden>Twitter</span> </a><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" aria-label=Facebook class=facebook title=Facebook> <i class="icon icon-facebook" aria-hidden=true></i><span class=hidden>Facebook</span> </a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/&title=Fare un dump da uno snapshot RDS con Python e Terraform" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;" aria-label=LinkedIn class=linkedin title=LinkedIn> <i class="icon icon-linkedin" aria-hidden=true></i><span class=hidden>LinkedIn</span> </a><a href="mailto:?subject=Fare un dump da uno snapshot RDS con Python e Terraform&body=https://www.simonemessaggi.it/2018/10/dump-rds-snapshot-to-sql-python-terraform/" aria-label=Email class=email title=Email> <i class="icon icon-mail" aria-hidden=true></i><span class=hidden>Email</span> </a><div class=clear></div></div><aside class=post-tags><a href=https://www.simonemessaggi.it/tag/aws-cloud/>AWS Cloud</a><a href=https://www.simonemessaggi.it/tag/rds/>RDS</a><a href=https://www.simonemessaggi.it/tag/mysql/>MySQL</a><a href=https://www.simonemessaggi.it/tag/terraform/>Terraform</a><a href=https://www.simonemessaggi.it/tag/python/>Python</a><a href=https://www.simonemessaggi.it/tag/howto/>Howto</a></aside><div class=clear></div></section><aside class=post-nav><a class=post-nav-next href=https://www.simonemessaggi.it/2018/11/la-mia-esperienza-di-lavoro-a-ilgiornaleit/> <section class=post-nav-teaser><i class="icon icon-arrow-left"></i><h2 class=post-nav-title>La mia esperienza di lavoro a ilGiornale.it</h2><p class=post-nav-excerpt>In quest'ultimo periodo, mi è capitato di riflettere a vario titolo su quello che ho...<p class=post-nav-meta><time datetime="Sun 11 November 2018">Sun 11 November 2018</time></section> </a><a class=post-nav-prev href=https://www.simonemessaggi.it/2018/08/lo-stato-della-fibra-a-rivolta-dadda/> <section class=post-nav-teaser><i class="icon icon-arrow-right"></i><h2 class=post-nav-title>Lo stato della fibra a Rivolta d'Adda</h2><p class=post-nav-excerpt>Scrivo questo post per predirre il futuro, quindi probabilmente mi sbaglierò, ma...<p class=post-nav-meta><time datetime="Tue 07 August 2018">Tue 07 August 2018</time></section> </a><div class=clear></div></aside></div></article></main><div class=nav-footer><nav aria-label=Footer class=nav-wrapper><span class=nav-copy><a href=/>SimoneMessaggi.it © 2025</a> </span><span class=nav-credits> Published with <a href=https://github.com/getpelican/pelican rel=nofollow>Pelican</a> • Theme <a href=https://github.com/arulrajnet/attila rel=nofollow>Attila</a> • <a class="menu-item js-theme" data-dark="Dark theme" data-light="Light theme" data-system="System theme" href=#> <span class=theme-icon></span><span class=theme-text>System theme</span> </a> </span></nav></div></section><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src="https://www.simonemessaggi.it/theme/js/jquery.fitvids.min.js?cb=122445"></script><script src="https://www.simonemessaggi.it/theme/js/script.min.js?cb=122445"></script><script src="/theme/js/ga.js?id=G-Q242MTLMK7" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Q242MTLMK7', { 'anonymize_ip': true });</script><script>$(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre";
    var rstSelector=".highlight pre";
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });</script>